(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[38],{"+89s":function(e,t,a){"use strict";a.r(t);var n=a("k1fw"),o=(a("Cvf5"),a("vprC")),l=a("0Owb"),r=(a("FR2D"),a("XQh4")),i=a("9og8"),d=a("PpiC"),c=a("tJVT"),s=a("WmNS"),u=a.n(s),v=a("q1tI"),p=a.n(v),m=a("BhE5"),f=a.n(m),h=(a("6Fki"),a("qDDj")),w=(a("unWr"),a("xVCw")),g=(a("zVZA"),a("2RU2")),x=(a("cN7o"),a("NYFC")),b=(a("PG1J"),a("M+Sw")),y={redo:"\u91cd\u505a",undo:"\u64a4\u9500","zoom-in":"\u653e\u5927","zoom-out":"\u7f29\u5c0f",fullscreen:"\u9002\u5e94\u753b\u5e03",delete:"\u5220\u9664","fullscreen-exit":"\u5b9e\u9645\u5c3a\u5bf8","deployment-unit":"\u6392\u5e8f",copy:"\u62f7\u8d1d\u89c4\u5219\u6d41"},N=e=>{var t,a=e||{},n=a.editor,l=a.previewMode,r=a.operateGroup,i=Object(v["useState"])(!1),d=Object(c["default"])(i,2),s=d[0],u=d[1],m=Object(v["useState"])(!1),f=Object(c["default"])(m,2),N=f[0],k=f[1],j=Object(v["useState"])(!1),E=Object(c["default"])(j,2),O=E[0],C=E[1],S=Object(v["useState"])(!1),z=Object(c["default"])(S,2),D=(z[0],z[1],n||{}),F=D.schema.history,L=D.graph,T=D.controller,M=D.paper;Object(v["useEffect"])((()=>{e.editor&&P(e)}),[e.editor]);var P=e=>{n&&(n.off("change"),n.off("node:click"),n.off("node:unactive"),n.off("paper:click"),n.off("node:remove"),n.on("change",(()=>{var e=F.index<F.schemaList.length-1,t=F.index>0;u(e),k(t)})),n.graph.on("node:click",(e=>{e.node;var t,a=0!==Object.keys(n.graph.node.actives).length||(null===(t=n.graph.line)||void 0===t?void 0:t.activeLine);C(a)})),n.graph.on("node:unactive",(()=>{var e,t=0!==Object.keys(n.graph.node.actives).length||(null===(e=n.graph.line)||void 0===e?void 0:e.activeLine);C(t)})),n.graph.on("paper:click",(()=>{var e,t=0!==Object.keys(n.graph.node.actives).length||(null===(e=n.graph.line)||void 0===e?void 0:e.activeLine);C(t)})),n.graph.on("node:remove",(()=>{C(!1)})))},B=()=>{n.schema.redo()},W=()=>{n.schema.undo()},R=()=>{var e=L||{},t=e.node,a=e.line,n=[];for(var o in t.actives)t.deleteNode(t.actives[o]),delete t.actives[o],n.push(o);a.activeLine&&a.deleteLine(a.activeLine),L.fire("delete",{deleteKeys:n})},A=e=>{var t=n.graph.line.lines,a=1,o=3;"x"===e&&(a=1,o=3,n.config.dagreOption={nodesep:90,ranksep:90,edgesep:40,rankdir:"LR"}),"y"===e&&(a=2,o=0,n.config.dagreOption={ranksep:60}),Object.values(t).forEach((e=>{e.data.fromPoint=a,e.data.toPoint=o})),n.schema.format(),n.controller.autoFit()},I=e=>{switch(e){case"redo":return s&&B;case"undo":return N&&W;case"zoom-in":return()=>{T.zoom(1.05)};case"zoom-out":return()=>{T.zoom(.95)};case"fullscreen":return()=>{T.autoFit()};case"fullscreen-exit":return()=>{var e=M.transform(),t=e.localMatrix.split(),a=t.scalex;T.zoom(1/a)};case"delete":return()=>{O&&R()}}},J=e=>{var t="";switch(e){case"redo":s||(t="disable");break;case"undo":N||(t="disable");break;case"delete":O||(t="disable");break}return t},V=e=>{var t=[];null===e||void 0===e||e.forEach((e=>{var a=null;if("object"===typeof e){var n=e;e=n.type,a=n.click}e&&t.push(p.a.createElement("span",{className:"".concat(J(e)," command-item"),onClick:a||I(e)},p.a.createElement(b["a"],{type:e}),y[e]))}));var a=p.a.createElement(x["a"],null,p.a.createElement(x["a"].Item,{onClick:()=>A("y")},"\u7eb5\u5411\u6392\u5e8f"),p.a.createElement(x["a"].Item,{onClick:()=>A("x")},"\u6a2a\u5411\u6392\u5e8f"));return t.push(p.a.createElement(g["a"],{overlay:a,placement:"bottomLeft"},p.a.createElement("label",{className:"command-item"},p.a.createElement(b["a"],{type:"deployment-unit"}),"\u683c\u5f0f\u5316\u6392\u5e8f"))),t},X=["zoom-out","zoom-in"];return X=l?X.concat(["fullscreen"]):X.concat(["fullscreen","fullscreen-exit","redo","undo","delete"]),n?p.a.createElement(p.a.Fragment,null,l&&p.a.createElement(w["a"].Group,{className:"flow-btn-wrap",size:"small"},null===(t=X)||void 0===t?void 0:t.map((e=>p.a.createElement(o["a"],{title:y[e],key:e},p.a.createElement(w["a"],{onClick:I(e)},p.a.createElement(b["a"],{type:e})))))),!l&&p.a.createElement("div",{className:"job-top-bar"},p.a.createElement(h["a"],{type:"flex",align:"middle",justify:"space-between",className:"flow-editor-hd"},p.a.createElement("div",null,V(X)),null===r||void 0===r?void 0:r.map((e=>p.a.createElement(w["a"],{loading:null===e||void 0===e?void 0:e.loading,type:null===e||void 0===e?void 0:e.type,onClick:null===e||void 0===e?void 0:e.click},null===e||void 0===e?void 0:e.name)))))):null},k=(a("plC5"),e=>{var t=e||{},a=t.onDrop,n=t.flowNodesDict,l=t.showType,r=Object(v["useState"])(null),i=Object(c["default"])(r,2),d=i[0],s=i[1],u=Object(v["useState"])(-990),m=Object(c["default"])(u,2),f=m[0],h=m[1],w=Object(v["useState"])(-990),g=Object(c["default"])(w,2),x=g[0],b=g[1],y=d||{},N=y.size,k=void 0===N?[]:N,j=e=>{s(e),h(-9990),b(-9990)},E=Object(v["useCallback"])((e=>{h(e.pageX),b(e.pageY+(document.body.getBoundingClientRect().top||0))}),[d]),O=Object(v["useCallback"])((e=>{a&&a(d,e),s(null),window.document.removeEventListener("mousemove",E),window.document.removeEventListener("mouseup",O)}),[d]);Object(v["useEffect"])((()=>{d&&(window.document.addEventListener("mousemove",E),window.document.addEventListener("mouseup",O))}),[d]);var C=()=>{var e=[];return null===n||void 0===n||n.map((t=>{var a=t.type||t.code,n=(a.toLowerCase(),t.shape);["circle"].includes(n)?e.push({type:a,name:t.name,shape:n,iconColor:t.iconColor,size:[50,50]}):["rhombus"].includes(n)?e.push({type:a,name:t.name,shape:n,size:[60,56]}):e.push({type:a,name:t.name,shape:"ellipse",prefixName:(null===t||void 0===t?void 0:t.iconText)||"?",iconColor:t.iconColor,size:[120,28]})})),e.map(((e,t)=>{if("subflow"===l&&["SubDecisionFlowNode"].indexOf(e.type)>-1)return null;var a=e||{},n=a.type,r=a.help;return p.a.createElement(o["a"],{key:t,placement:"right",overlayStyle:{fontSize:12},title:r},p.a.createElement("div",{key:n,className:"flow-item ".concat(S(e)),onMouseDown:()=>{j(e)}},z(e)))}))},S=e=>{var t=e.type,a=e.shape,n=a?"flow-".concat(a):"",o=t.toLowerCase();return null!==o&&void 0!==o&&o.startsWith("start")&&(n+=" start"),null!==o&&void 0!==o&&o.startsWith("end")&&(n+=" end"),null!==o&&void 0!==o&&o.startsWith("exclusive")&&(n+=" exclusive"),null!==o&&void 0!==o&&o.startsWith("parallel")&&(n+=" parallel"),n},z=e=>p.a.createElement(p.a.Fragment,null,(null===e||void 0===e?void 0:e.prefixName)&&p.a.createElement("span",{style:{backgroundColor:(null===e||void 0===e?void 0:e.iconColor)||"#e6b55e"}},null===e||void 0===e?void 0:e.prefixName),null===e||void 0===e?void 0:e.name);return p.a.createElement("div",{className:"job-left-bar"},p.a.createElement("div",{style:{left:null!==d&&void 0!==d&&d.name?f-k[0]/2:-9999,top:null!==d&&void 0!==d&&d.name?x-k[1]/2:-9999,display:null!==d&&void 0!==d&&d.type?"block":"none",zIndex:10},className:"".concat(d?S(d):""," flow-item drag-item")},z(d)),p.a.createElement("div",{className:"item-list"},C()))}),j=a("lFvh"),E=a.n(j),O=a("hOeV"),C=a.n(O);function S(e,t){var a=(e,t)=>{for(var a=[],n=0;n<e.length;n++){var o=e.charCodeAt(n);n<t&&(o>=1&&o<=126||o>=65376&&o<=65439?a.push("0.5","0.5"):a.push("1"))}return a},n=(e,t,n)=>{var o,l=e.name,r=l;r&&(console.log("getStrLen(name) ",a(r,6)),r=r.slice(0,null===(o=a(r,6))||void 0===o?void 0:o.length)+"...");var i=t.text(15,15,n.iconText),d=t.circle(15,14,11);i.attr({fill:"#fff",fontSize:12}),d.attr({fill:n.color});var c=t.group(d,i),s=t.text(30,15,r),u=s.getBBox(),v=u.w,p=t.rect(0,0,Math.max(v+40,120),28,15,15);p.attr({fill:"#eaeefa",stroke:"#d0dcfd",class:"flow-icon-node",strokeWidth:1}),s.attr({fill:"#454f64",textAnchor:"start",data:r,class:"flow-txt-node",fontSize:12});var m=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");m.innerHTML='<span xmlns="http://www.w3.org/1999/xhtml" class="task-status"></span>';var f=window.Snap(m);return f.attr({width:14,height:14,x:p.getBBox().width-14,y:0}),t.group(p,c,s,f)},o=()=>{var a=function(a){var o=t[a],l=(null===o||void 0===o?void 0:o.type)||(null===o||void 0===o?void 0:o.code),r=null===l||void 0===l?void 0:l.toLowerCase();r.startsWith("start")?e.graph.node.registeNode(l,{render:(e,t)=>{var a=t.circle(25,25,25),n=t.text(25,25,e.name);return a.attr({fill:"#628FE4",class:"flow-icon-node"}),n.attr({fill:"#fff",class:"flow-txt-node"}),t.group(a,n)},linkPoints:[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}]},"default"):r.startsWith("end")?e.graph.node.registeNode(l,{render:(e,t)=>{var a=t.circle(25,25,25),n=t.text(25,25,e.name);return a.attr({fill:"#869FBE",class:"flow-icon-node"}),n.attr({fill:"#fff",class:"flow-txt-node"}),t.group(a,n)},linkPoints:[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}]},"default"):r.startsWith("parallel")?e.graph.node.registeNode("ParallelGateway",{render:(e,t)=>{var a,n=t.image(C.a,0,0,60,56);n.node.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var o=t.text(30,28,e.name);return o.attr({fill:"#24AF95",class:"flow-txt-node"}),null===o||void 0===o||null===(a=o.node)||void 0===a||a.setAttribute("font-size","12px"),t.group(n,o)},linkPoints:[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}]},"default"):r.startsWith("exclusive")?e.graph.node.registeNode("ExclusiveGateway",{render:(e,t)=>{var a,n=t.image(E.a,0,0,60,56);n.node.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var o=t.text(30,28,e.name);return o.attr({fill:"#F67613",class:"flow-txt-node"}),null===o||void 0===o||null===(a=o.node)||void 0===a||a.setAttribute("font-size","12px"),t.group(n,o)},linkPoints:[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}]},"default"):e.graph.node.registeNode(l,{render:(e,t)=>n(e,t,{iconText:o.iconText||"?",color:o.iconColor||"#E6B55E"}),linkPoints:[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1},{x:0,y:.5}]},"iconNode")};for(var o in t)a(o)};o()}var z={convert(e){var t={nodes:[],lines:[]},a={},n=e.flowNodeDefinitions,o=void 0===n?[]:n,l=e.flowLineDefinitions,r=void 0===l?[]:l;return t.nodes=o.map((e=>{a[e.id]=e,e.attributes=e.attributes||{},e.incomingFields=e.incomingFields||[],e.outgoingFields=e.outgoingFields||[];var t={uuid:e.id,x:e.x,y:e.y,type:e.nodeType,name:e.name,data:{}};return t})),t.lines=r.map((e=>{e.attributes=e.attributes||{};var t={uuid:e.id,fromPoint:e.fromPoint,toPoint:e.toPoint,data:{},from:e.sourceNodeId,to:e.targetNodeId};return t})),t}},D=z;class F{constructor(e){this.showType=e}show(e,t,a){return Object(i["default"])(u.a.mark((function n(){var o,l;return u.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:l=e.data,"SubDecisionFlowNode"===(null===e||void 0===e||null===(o=e.data)||void 0===o?void 0:o.type)&&t.graph.node.unActive(e),a({nodeId:l.uuid,type:l.fromType||l.type});case 3:case"end":return n.stop()}}),n)})))()}}var L=F;a("hiJZ"),t["default"]=e=>{var t,a=Object(v["useRef"])(),s=Object(v["useRef"])(),m=Object(v["useRef"])(),h=Object(v["useState"])(),w=Object(c["default"])(h,2),g=w[0],x=w[1],b=Object(v["useState"])(null),y=Object(c["default"])(b,2),j=y[0],E=y[1],O=(null===s||void 0===s?void 0:s.current)||{},C=(O.graph,e.type),z=e.graphData,F=e.flowNodesDict,T=void 0===F?[]:F,M=e.auditedNodes,P=void 0===M?[]:M,B=e.className,W=e.showMiniMap,R=void 0===W||W,A=e.DataConvert,I=e.toolTipNameHandle,J=e.dialogHide,V=e.showType,X=e.dialogDom,Y=void 0===X?[]:X,G=e.editorStyle,H=(Object(d["a"])(e,["type","graphData","flowNodesDict","auditedNodes","className","showMiniMap","DataConvert","toolTipNameHandle","dialogHide","showType","dialogDom","editorStyle"]),"view"===C);Object(v["useEffect"])((()=>{m.current=new L(V);var e=document.querySelector(".job-editor").getBoundingClientRect(),t=e.height,n=e.width;t&&a&&(a.current.style.height=t-(H?0:48)+"px",a.current.style.width=n-(H?0:140)+"px"),s.current=new f.a({dom:a.current,showMiniMap:R,mode:H?"view":"edit"}),window.mm=s.current,S(s.current,T),z&&q(z),Z()}),[]);var q=function(){var e=Object(i["default"])(u.a.mark((function e(t){var a,n,o;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,n="object"===typeof t?t:JSON.parse(t||"{}"),o=D,A&&(o=A),e.next=6,s.current.schema.setInitData(null===(a=o)||void 0===a?void 0:a.convert(n,s.current));case 6:return e.next=8,s.current.controller.autoFit();case 8:K(),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),r["a"].error("\u89e3\u6790\u6570\u636e\u9519\u8bef,"+(null===e.t0||void 0===e.t0?void 0:e.t0.message));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),Z=()=>{var t;null===s||void 0===s||s.current.graph.on("node:click",(a=>{var n,o,l=a.node;null===(n=document.getElementsByClassName("lb-workflow-header")[0])||void 0===n||null===(o=n.children[1])||void 0===o||o.blur();var r=(new Date).getTime();r-t<300&&!J&&m.current.show(l,null===s||void 0===s?void 0:s.current,(e=>{E(e)})),t=r,e.onNodeClick&&e.onNodeClick(l.data)})),null===s||void 0===s||s.current.graph.on("node:mouseenter",(e=>{var t=e.node,a=t.node.getBoundingClientRect();x({nowTextNode:I?I(t.data):t.data,textVisible:!0,textX:a.x+a.width/2,textY:a.y-5})})),null===s||void 0===s||s.current.graph.on("node:mouseleave",(()=>{x(null)})),null===s||void 0===s||s.current.graph.on("node:remove",(()=>{x(null)}))},K=function(){var e=Object(i["default"])(u.a.mark((function e(){var t,a,n,o,l,r,i,d,c,v,p;return u.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!==P&&void 0!==P&&P.length){e.next=2;break}return e.abrupt("return");case 2:for(d in t=(null===s||void 0===s?void 0:s.current)||{},a=t.graph,n=a||{},o=n.node.nodes,l=n.line.lines,r=[],i=[],P.forEach((e=>{r.push(null===e||void 0===e?void 0:e.uuid)})),P.forEach((e=>{var t=e||{},a=t.uuid,n="instance ".concat(e.status||"");for(var d in Object.values(o).forEach((e=>{e.data.uuid===a&&(e.data.className="".concat(e.data.className||""," ").concat(n),e.addClass(n))})),l){var c=l[d];a===c.data.to&&r.indexOf(c.data.from)>-1&&(c.data.className="".concat(c.data.className||"","  ").concat(n),c.addClass(n),i.push(c.data.uuid))}})),o)r.includes(d)||(c=o[d],c.data.className="".concat(c.data.className||""," unrun"),c.addClass("unrun"));for(v in l)i.includes(v)||(p=l[v],p.data.className="".concat(p.data.className||""," unrun"),p.addClass("unrun"));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=(e,t)=>{var a,n,o=null===s||void 0===s||null===(a=s.current)||void 0===a?void 0:a.dom.node,l=(null===e||void 0===e?void 0:e.initName)||(null===e||void 0===e?void 0:e.name),r=e||{},i=r.size,d=void 0===i?[]:i,c=null===s||void 0===s?void 0:s.current.paper.transform(),u=c.globalMatrix.split(),v=o.getBoundingClientRect();if(!(t.clientX-v.x<0||t.clientY-v.y<0)){var p=(t.clientX-v.x-u.dx)/u.scalex-d[0]/2*u.scalex,m=(t.clientY-v.y-u.dy)/u.scalex-d[1]/2*u.scalex;null===s||void 0===s||null===(n=s.current)||void 0===n||n.graph.node.addNode(Object.assign({},e,{type:null===e||void 0===e?void 0:e.type,data:(null===e||void 0===e?void 0:e.data)||{},name:l,x:p,y:m}))}};return p.a.createElement("div",Object(l["default"])({className:"job-editor ".concat(B||"")},G),!H&&(null===s||void 0===s?void 0:s.current)&&p.a.createElement(k,Object(l["default"])({},e,{editor:s.current,onDrop:Q})),p.a.createElement("div",{className:"job-content flow-editor-content"},!(null===s||void 0===s||!s.current)&&p.a.createElement(N,Object(l["default"])({},e,{previewMode:H,editor:s.current})),p.a.createElement("div",{className:"job-mm-editor",ref:a})),p.a.createElement("div",{style:{position:"fixed",left:null===g||void 0===g?void 0:g.textX,top:null===g||void 0===g?void 0:g.textY,display:null!==g&&void 0!==g&&g.textVisible?"block":"none"}},p.a.createElement(o["a"],{visible:!0,title:"".concat(null===g||void 0===g||null===(t=g.nowTextNode)||void 0===t?void 0:t.name)})),null===Y||void 0===Y?void 0:Y.map((t=>p.a.cloneElement(t,Object(n["a"])(Object(n["a"])({},e),{},{dialogShowInfo:j,disabled:H,editor:null===s||void 0===s?void 0:s.current,onCancel:()=>{E(null)}})))))}},hOeV:function(e,t,a){e.exports=a.p+"static/flow-parallel.7e09bc25.svg"},hiJZ:function(e,t,a){},lFvh:function(e,t,a){e.exports=a.p+"static/flow-exclusivity.29399230.svg"},plC5:function(e,t,a){}}]);